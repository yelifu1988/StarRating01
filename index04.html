<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>星级评分04 可扩展整颗或者半颗模式</title>
    <script src="js/jquery-2.2.4.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<ul id="rating01" class="rating clearfix">
    <li class="rating-item" title="很不好"></li>
    <li class="rating-item" title="不好"></li>
    <li class="rating-item" title="一般"></li>
    <li class="rating-item" title="好"></li>
    <li class="rating-item" title="很好"></li>
</ul>
<ul id="rating02" class="rating clearfix">
    <li class="rating-item" title="很不好"></li>
    <li class="rating-item" title="不好"></li>
    <li class="rating-item" title="一般"></li>
    <li class="rating-item" title="好"></li>
    <li class="rating-item" title="很好"></li>
</ul>

<ul id="rating03" class="rating clearfix">
    <li class="rating-item" title="很不好"></li>
    <li class="rating-item" title="不好"></li>
    <li class="rating-item" title="一般"></li>
    <li class="rating-item" title="好"></li>
    <li class="rating-item" title="很好"></li>
</ul>


<script>
    var rating = (function () {


        //点亮整颗星星的构造函数，子类
        var LightEntire = function (el, options) {
            this.$el = $(el);
            this.$item = this.$el.find('.rating-item');
            this.opts = options;
        };
        //点亮整颗星星的初始化
        LightEntire.prototype.init = function () {
            this.lightOn(this.opts.num);//默认点亮几颗星星
            if(!this.opts.readOnly){//判断是否只读
                this.bindEvent();//绑定事件
            }
        };
        //点亮方法
        LightEntire.prototype.lightOn = function (num) {
            this.$item.each(function (index) {
                num = parseInt(num);//强制转化成整数
                if (index < num){
                    $(this).css('background-position','0 -40px')
                }else {
                    $(this).css('background-position','0 0')
                }
            })
        };
        //绑定事件方法
        LightEntire.prototype.bindEvent = function () {
            var self = this;//保存this指向
            var itemLength = self.$item.length;//一共有几颗星星
            self.$el.on('mouseover','.rating-item',function () {
                var num = $(this).index()+1;
                self.lightOn(num);//当前的第几颗星星
                (typeof self.opts.select === "function") && self.opts.select.call(this,num,itemLength);//先判断select是否是函数
                }).on('click','.rating-item',function () {
                var num = $(this).index()+1;
                (typeof self.opts.chosen === "function") && self.opts.chosen.call(this,num,itemLength);
                    self.opts.num = $(this).index()+1
                }).on('mouseout',function () {
                    self.lightOn(self.opts.num)
                })
        };


        //点亮半颗颗星星的构造函数，子类
        var LightHalf = function (el, options) {
            this.$el = $(el);
            this.$item = this.$el.find('.rating-item');
            this.opts = options;
            this.add = 1;//默认是1 也就是整颗
        };
        //点亮半颗星星的初始化
        LightHalf.prototype.init = function () {
            this.lightOn(this.opts.num);//默认点亮几颗星星
            if(!this.opts.readOnly){//判断是否只读
                this.bindEvent();//绑定事件
            }
        };
        //点亮方法
        LightHalf.prototype.lightOn = function (num) {
            var count = parseInt(num);
            var isHalf = count !== num;//判断是否等于num本身，如果不等于就说明是半颗
            this.$item.each(function (index) {
                if (index < count){
                    $(this).css('background-position','0 -40px')
                }else {
                    $(this).css('background-position','0 0')
                }
            });

            if (isHalf){
                this.$item.eq(count).css('background-position','0 -80px')
            }
        };
        //绑定事件方法
        LightHalf.prototype.bindEvent = function () {
            var self = this;//保存this指向
            var itemLength = self.$item.length;//一共有几颗星星

            self.$el.on('mousemove','.rating-item',function (e) {

                var $this = $(this);
                var num =0;

                if(e.pageX-$this.offset().left < $this.width()/2){//判断鼠标移动的距离是否是点亮半颗的位置,半颗
                    self.add = 0.5;
                }else {//整颗
                    self.add = 1;
                }

                num = $(this).index()+self.add;
                self.lightOn(num);//当前的第几颗星星
                (typeof self.opts.select === "function") && self.opts.select.call(this,num,itemLength);//先判断select是否是函数

            }).on('click','.rating-item',function () {

                self.opts.num = $(this).index()+self.add;
                (typeof self.opts.chosen === "function") && self.opts.chosen.call(this,self.opts.num,itemLength);
                self.$el.trigger('chosen',[self.opts.num,itemLength])

            }).on('mouseout',function () {

                self.lightOn(self.opts.num)

            })
        };


        /*
        * 以下是父类公用
        * */
        //默认参数
        var defaults = {
            mode:'LightEntire',//默认是点亮整颗星星模式
            num:0,//显示第几颗星
            readOnly:false,//只读，只允许显示而不允许操作，默认false
            select:function () {//鼠标移动到每一颗星星上的执行方法

            },
            chosen:function () {//点击某一颗星星执行的方法--比如用ajax把当前评分发送出去
                
            }
        };
        //模式映射
        var mode = {
            'LightEntire': LightEntire,
            'LightHalf': LightHalf
        };

        //初始化
        var init = function (el,options) {
            options = $.extend({},defaults,options);//用户参数覆盖默认参数，第一个参数{}存放替换后的参数并返回给options
//            new LightEntire(el,options).init();
//              new LightHalf(el,options).init();

            //容错机制 ，判断是否存在，不存在就自动设置为默认，这样  用户在写参数的时候写错 或是瞎写就是默认点亮整颗模式
            if (!mode[options.mode]){
                options.mode = 'LightEntire'
            }
            //直接new mode
            new mode[options.mode](el,options).init();
        };
        return {
            init:init
        }
    })();

    rating.init("#rating01",{
        mode:'LightHalf',//模式选择，半颗模式或者整颗模式
        num:2.5,
        select:function (num,total) {
//            console.log(this);//打印出的是LightEntire对象，我们希望在select方法中this指向的是每一颗星星,所以要在64行用call方法改变this指向
//            console.log(num + '/' + total)//当前第几颗，一共多少颗
        },
        chosen:function (num,total) {
//            console.log(this);
//            console.log(num + '/' + total)
        }

    })



//    $(function () {
//        //(function () {})() 自执行函数 避免污染全局空间
//        var rating = (function () {
//
//            //lightOn 要调用很多次 所以提取出来 由于$item是在init中声明的所以要把$item传进来
//            var lightOn = function ($item,num) {
//                $item.each(function (index) {
//                    if (index < num){
//                        $(this).css('background-position','0 -40px')
//                    }else {
//                        $(this).css('background-position','0 0')
//                    }
//                })
//            };
//
//            var init = function (el,num) {
//                var $rating = $(el);
//                var $item = $rating.find('.rating-item');
//
//                lightOn($item,num);
//                $rating.on('mouseover','.rating-item',function () {
//                    lightOn($item,$(this).index()+1)
//                }).on('click','.rating-item',function () {
//                    num = $(this).index()+1
//                }).on('mouseout',function () {
//                    lightOn($item,num)
//                })
//
//            };
//
//            //jquery插件
//            $.fn.extend({
//                rating:function (num) {
//                    return this.each(function () {
//                        init(this,num)
//                    })
//                }
//            });
//
//        })();
//
//        $('#rating01').rating(1);
//        $('#rating02').rating(2);
//        $('#rating03').rating(3)
//
//    })
</script>
</body>
</html>